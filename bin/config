#!/bin/bash

progdir=`dirname $0`
cd $progdir

dRoot="$PWD/.."
dData="$dRoot/data"
dBin="$dRoot/bin"
dBuild="$dRoot/build"
dBuildInclude="${dBuild}/include"
dBuildModuleInclude="$dBuildInclude/modules"
dBuildSrc="$dBuild/src"
dModules="$dRoot/modules"
dScript="$dRoot/script"
dTmp="/tmp"

xPython="python"
xReplace="${xPython} ${dScript}/replace.py"
xSh="bash"

base_SOURCES_TYPES=( \
$dRoot/src/t/Array.cpp \
$dRoot/src/t/Block.cpp \
$dRoot/src/t/Bool.cpp \
$dRoot/src/t/Class.cpp \
$dRoot/src/t/CoreFunction.cpp \
$dRoot/src/t/Exception.cpp \
$dRoot/src/t/File.cpp \
$dRoot/src/t/Float.cpp \
$dRoot/src/t/Function.cpp \
$dRoot/src/t/HeapObject.cpp \
$dRoot/src/t/List.cpp \
$dRoot/src/t/Map.cpp \
$dRoot/src/t/Object.cpp \
$dRoot/src/t/String.cpp \
$dRoot/src/t/Int.cpp \
$dRoot/src/t/UnicodeString.cpp \
$dRoot/src/t/UserFunction.cpp \
$dRoot/src/t/UserObject.cpp \
$dRoot/src/t/Variable.cpp \
)

base_SOURCES=( \
$dRoot/src/debug.cpp \
$dRoot/src/vm/ClassTable.cpp \
$dRoot/src/vm/ClassTableEntry.cpp \
$dRoot/build/src/vm/EngineStarter.cpp \
$dRoot/build/src/vm/Engine.cpp \
$dRoot/src/vm/FieldTable.cpp \
$dRoot/src/vm/FunctionTable.cpp \
$dRoot/src/vm/FunctionTableEntry.cpp \
$dRoot/src/vm/Heap.cpp \
$dRoot/src/vm/OpCode.cpp \
$dRoot/src/vm/Parser.cpp \
$dRoot/src/vm/Stack.cpp \
)

base_utils_SOURCES=( \
$dRoot/src/util/Class.cpp \
$dRoot/src/util/Int.cpp \
$dRoot/src/util/List.cpp \
$dRoot/src/util/Object.cpp \
$dRoot/src/util/String.cpp \
)

release_SOURCES=( ${base_SOURCES_TYPES[@]} ${base_utils_SOURCES[@]} ${base_SOURCES[@]} $dRoot/src/main.cpp )

t_SOURCES=( ${base_SOURCES_TYPES[@]} $dRoot/src/main_t.cpp $dRoot/src/vm/Heap.cpp )

debug_SOURCES=( ${release_SOURCES[@]} )

bin_PROGRAMS="svm"

svm_SOURCES=($dRoot/src/main.cpp ${base_SOURCES[*]})
svm_CXXFLAGS="-I$dBuild/include -I$dRoot/include -Wall"
svm_LDADD="-licui18n -licuuc -licudata"
svm_CXX="g++ $svm_CXXFLAGS $svm_LDADD -DPACKAGE_NAME=\"Qd\" -DPACKAGE_AUTHOR_NAME=\"ThomasQuemard\" -DPACKAGE_VERSION=\""`cat $dRoot/VERSION`"\""
svm_OUTPUT="$dBuild/svm"

debug_CXX="$svm_CXX -pg -O0 -D __DEBUG__=1 -D USE_COLORS=1"
debug_OUTPUT="$svm_OUTPUT"

svm_internal_CXX="$svm_CXX -pg -O0 -D __INTERNAL__=1 -D USE_COLORS=1"
svm_internal_OUTPUT="$svm_OUTPUT"

svm_introspection_CXX="$svm_CXX -pg -O0 -D __INTROSPECTION__=1 -D USE_COLORS=1"
svm_introspection_OUTPUT="$svm_OUTPUT"

svm_t_CXX="$svm_CXX -pg -O0 -D __INTROSPECTION__=1 -D USE_COLORS=1"
svm_t_OUTPUT="$svm_OUTPUT"

